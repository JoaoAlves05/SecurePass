 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/extension/background/serviceWorker.js b/extension/background/serviceWorker.js
index 02eececf112fcbd4dc5867a1088b689ef512a44c..96577201345829b3186bd5215896f86067857695 100644
--- a/extension/background/serviceWorker.js
+++ b/extension/background/serviceWorker.js
@@ -1,80 +1,130 @@
 import { checkPassword } from '../src/hibp.js';
 import { generatePassword } from '../src/passwordGenerator.js';
 import { loadSettings, saveSettings, DEFAULT_SETTINGS } from '../src/settings.js';
-import { initializeVault, unlockVault, storeCredential, listCredentials, lockVault, vaultStatus } from '../src/cryptoVault.js';
+import {
+  initializeVault,
+  unlockVault,
+  storeCredential,
+  updateCredential,
+  deleteCredential,
+  listCredentials,
+  lockVault,
+  vaultStatus,
+  changeMasterPassword
+} from '../src/cryptoVault.js';
 
 chrome.runtime.onInstalled.addListener(async () => {
   const settings = await loadSettings();
   await saveSettings({ ...DEFAULT_SETTINGS, ...settings });
 });
 
 chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
   const handler = async () => {
     switch (message.type) {
       case 'HIBP_CHECK': {
         try {
           const result = await checkPassword(message.password);
           sendResponse({ ok: true, result });
         } catch (error) {
           sendResponse({ ok: false, error: error.message });
         }
         break;
       }
       case 'GENERATE_PASSWORD': {
-        const generated = await generatePassword(message.constraints || {});
-        sendResponse({ ok: true, password: generated });
+        try {
+          const generated = await generatePassword(message.constraints || {});
+          sendResponse({ ok: true, password: generated });
+        } catch (error) {
+          sendResponse({ ok: false, error: error.message });
+        }
         break;
       }
       case 'LOAD_SETTINGS': {
         const settings = await loadSettings();
         sendResponse({ ok: true, settings });
         break;
       }
       case 'SAVE_SETTINGS': {
         await saveSettings(message.settings);
         sendResponse({ ok: true });
         break;
       }
       case 'UNLOCK_VAULT': {
         try {
           await initializeVault(message.passphrase);
           const data = await unlockVault(message.passphrase, message.timeoutMinutes);
           sendResponse({ ok: true, data });
         } catch (error) {
           sendResponse({ ok: false, error: error.message });
         }
         break;
       }
       case 'STORE_CREDENTIAL': {
         try {
-          await storeCredential(message.entry, message.passphrase);
+          const entry = await storeCredential(message.entry, message.passphrase);
+          sendResponse({ ok: true, entry });
+        } catch (error) {
+          sendResponse({ ok: false, error: error.message });
+        }
+        break;
+      }
+      case 'UPDATE_CREDENTIAL': {
+        try {
+          const entry = await updateCredential(message.id, message.updates, message.passphrase);
+          sendResponse({ ok: true, entry });
+        } catch (error) {
+          sendResponse({ ok: false, error: error.message });
+        }
+        break;
+      }
+      case 'DELETE_CREDENTIAL': {
+        try {
+          await deleteCredential(message.id, message.passphrase);
           sendResponse({ ok: true });
         } catch (error) {
           sendResponse({ ok: false, error: error.message });
         }
         break;
       }
       case 'LIST_CREDENTIALS': {
         const status = await vaultStatus();
         const entries = await listCredentials();
         sendResponse({ ok: true, entries, unlocked: status.unlocked });
         break;
       }
       case 'LOCK_VAULT': {
         lockVault();
         sendResponse({ ok: true });
         break;
       }
       case 'VAULT_STATUS': {
         const status = await vaultStatus();
         sendResponse({ ok: true, status });
         break;
       }
+      case 'INITIALIZE_VAULT': {
+        try {
+          const created = await initializeVault(message.passphrase);
+          sendResponse({ ok: true, created });
+        } catch (error) {
+          sendResponse({ ok: false, error: error.message });
+        }
+        break;
+      }
+      case 'CHANGE_MASTER_PASSWORD': {
+        try {
+          await changeMasterPassword(message.oldPassphrase, message.newPassphrase);
+          sendResponse({ ok: true });
+        } catch (error) {
+          sendResponse({ ok: false, error: error.message });
+        }
+        break;
+      }
       default:
         sendResponse({ ok: false, error: 'Unknown message type' });
     }
   };
 
   handler();
   return true;
 });
diff --git a/extension/popup/popup.css b/extension/popup/popup.css
index ae5409f18a91e81f6a4e0e50ed98c1a69d6100dd..4ca1c006939bb698732d1ef70519e0420f34d529 100644
--- a/extension/popup/popup.css
+++ b/extension/popup/popup.css
@@ -1,169 +1,601 @@
 :root {
   color-scheme: light dark;
-  --background: #0f172a;
-  --foreground: #e2e8f0;
-  --card: rgba(30, 41, 59, 0.85);
-  --accent: #38bdf8;
-  --danger: #f87171;
-  --warning: #facc15;
-  --success: #34d399;
-  font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
+  --bg: #f4f6fb;
+  --surface: #ffffff;
+  --surface-muted: rgba(255, 255, 255, 0.6);
+  --border: #dbe1f1;
+  --text: #1a1f36;
+  --text-muted: #4d5776;
+  --primary: #3b82f6;
+  --primary-contrast: #ffffff;
+  --primary-soft: rgba(59, 130, 246, 0.12);
+  --success: #16a34a;
+  --warning: #f59e0b;
+  --danger: #dc2626;
+  --shadow: 0 12px 24px rgba(26, 31, 54, 0.08);
+  --radius: 16px;
+  --font: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
+}
+
+body[data-theme='dark'] {
+  --bg: #101322;
+  --surface: #161b2f;
+  --surface-muted: rgba(22, 27, 47, 0.7);
+  --border: rgba(255, 255, 255, 0.08);
+  --text: #f8fafc;
+  --text-muted: #cbd5f5;
+  --shadow: 0 16px 32px rgba(0, 0, 0, 0.35);
+  --primary-soft: rgba(59, 130, 246, 0.24);
+}
+
+* {
+  box-sizing: border-box;
 }
 
 body {
   margin: 0;
-  padding: 1rem;
-  width: 360px;
-  background: var(--background);
-  color: var(--foreground);
+  font-family: var(--font);
+  background: radial-gradient(circle at top, rgba(59, 130, 246, 0.16), transparent 55%), var(--bg);
+  color: var(--text);
+  min-width: 360px;
 }
 
-body[data-theme='light'] {
-  --background: #f8fafc;
-  --foreground: #0f172a;
-  --card: rgba(226, 232, 240, 0.85);
+.app {
+  padding: 16px 18px 24px;
+  display: flex;
+  flex-direction: column;
+  gap: 16px;
+  max-width: 420px;
 }
 
-header {
+.app-header {
   display: flex;
-  align-items: center;
   justify-content: space-between;
-  margin-bottom: 1rem;
+  align-items: center;
+  background: var(--surface);
+  border-radius: var(--radius);
+  padding: 14px 16px;
+  box-shadow: var(--shadow);
+  border: 1px solid var(--border);
+}
+
+.brand {
+  display: flex;
+  align-items: center;
+  gap: 12px;
+}
+
+.brand-icon {
+  font-size: 28px;
 }
 
 h1 {
-  font-size: 1.15rem;
+  font-size: 1.1rem;
   margin: 0;
 }
 
-button {
+.subtitle {
+  margin: 2px 0 0;
+  font-size: 0.8rem;
+  color: var(--text-muted);
+}
+
+.view-switcher {
+  display: grid;
+  grid-template-columns: repeat(2, 1fr);
+  gap: 8px;
+  background: transparent;
   border: none;
-  background: var(--accent);
-  color: #0f172a;
-  padding: 0.35rem 0.75rem;
-  border-radius: 6px;
+  padding: 0;
+}
+
+.tab {
+  border-radius: 999px;
+  padding: 10px 16px;
+  background: transparent;
+  border: 1px solid transparent;
+  font-weight: 600;
+  color: var(--text-muted);
   cursor: pointer;
+  transition: all 0.2s ease;
+}
+
+.tab.active {
+  background: var(--primary-soft);
+  border-color: rgba(59, 130, 246, 0.4);
+  color: var(--primary);
+  box-shadow: 0 4px 14px rgba(59, 130, 246, 0.2);
+}
+
+main {
+  display: flex;
+  flex-direction: column;
+  gap: 16px;
+}
+
+.view {
+  display: none;
+  flex-direction: column;
+  gap: 16px;
+}
+
+.view.active {
+  display: flex;
+}
+
+.panel {
+  background: var(--surface);
+  border-radius: var(--radius);
+  padding: 20px;
+  border: 1px solid var(--border);
+  box-shadow: var(--shadow);
+  display: flex;
+  flex-direction: column;
+  gap: 16px;
+}
+
+.panel-header h2 {
+  margin: 0;
+  font-size: 1.05rem;
+}
+
+.panel-header p {
+  margin: 4px 0 0;
+  color: var(--text-muted);
+  font-size: 0.85rem;
+}
+
+.field-group {
+  display: flex;
+  flex-direction: column;
+  gap: 8px;
+}
+
+label {
   font-weight: 600;
+  font-size: 0.85rem;
 }
 
-button:disabled {
-  opacity: 0.6;
-  cursor: not-allowed;
+input,
+textarea,
+button {
+  font-family: inherit;
 }
 
-.input-wrapper {
+input,
+textarea {
+  width: 100%;
+  padding: 10px 12px;
+  border-radius: 12px;
+  border: 1px solid var(--border);
+  background: var(--surface-muted);
+  color: var(--text);
+  transition: border-color 0.2s ease, background 0.2s ease;
+}
+
+input:focus,
+textarea:focus {
+  outline: none;
+  border-color: var(--primary);
+  background: rgba(59, 130, 246, 0.1);
+}
+
+textarea {
+  resize: vertical;
+}
+
+.input-with-actions {
   display: flex;
-  border-radius: 6px;
-  overflow: hidden;
-  border: 1px solid rgba(148, 163, 184, 0.4);
-  background: rgba(15, 23, 42, 0.6);
+  align-items: center;
+  gap: 8px;
 }
 
-.input-wrapper input {
+.input-with-actions input {
   flex: 1;
+}
+
+.icon-button {
   border: none;
+  background: var(--surface-muted);
+  color: var(--text-muted);
+  border-radius: 12px;
+  padding: 8px 10px;
+  cursor: pointer;
+  transition: background 0.2s ease, color 0.2s ease;
+}
+
+.icon-button:hover {
+  background: rgba(59, 130, 246, 0.14);
+  color: var(--primary);
+}
+
+.primary,
+.secondary {
+  border-radius: 12px;
+  padding: 10px 14px;
+  font-weight: 600;
+  border: none;
+  cursor: pointer;
+  transition: transform 0.2s ease, box-shadow 0.2s ease;
+}
+
+button:disabled,
+.primary:disabled,
+.secondary:disabled,
+.icon-button:disabled,
+.action-btn:disabled {
+  opacity: 0.6;
+  cursor: not-allowed;
+  box-shadow: none;
+}
+
+.primary {
+  background: linear-gradient(135deg, #3b82f6, #2563eb);
+  color: var(--primary-contrast);
+  box-shadow: 0 10px 20px rgba(37, 99, 235, 0.25);
+}
+
+.primary:active {
+  transform: translateY(1px);
+}
+
+.secondary {
   background: transparent;
-  color: var(--foreground);
-  padding: 0.5rem;
+  color: var(--primary);
+  border: 1px solid rgba(59, 130, 246, 0.35);
+}
+
+.generator-controls {
+  display: flex;
+  flex-direction: column;
+  gap: 12px;
+}
+
+.check-grid {
+  display: grid;
+  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
+  gap: 8px;
+}
+
+.checkbox {
+  display: flex;
+  align-items: center;
+  gap: 8px;
+  padding: 10px;
+  border: 1px solid var(--border);
+  border-radius: 12px;
+  background: var(--surface-muted);
+  font-weight: 500;
 }
 
-.input-wrapper button {
-  border-radius: 0;
+.checkbox input {
+  width: auto;
 }
 
-.meter {
+.strength-meter {
+  display: flex;
+  flex-direction: column;
+  gap: 8px;
+}
+
+.meter-track {
+  width: 100%;
   height: 10px;
+  border-radius: 999px;
   background: rgba(148, 163, 184, 0.3);
-  border-radius: 6px;
   overflow: hidden;
-  margin: 0.75rem 0 0.5rem;
 }
 
-#strengthBar {
+.meter-bar {
   height: 100%;
-  width: 0%;
+  width: 6%;
+  border-radius: inherit;
   background: var(--danger);
   transition: width 0.3s ease, background 0.3s ease;
 }
 
-.meta {
+.meter-labels {
   display: flex;
-  justify-content: space-between;
-  font-size: 0.75rem;
-  opacity: 0.85;
+  flex-wrap: wrap;
+  gap: 8px 12px;
+  align-items: center;
+  font-size: 0.85rem;
+  color: var(--text-muted);
 }
 
-#suggestions {
-  margin: 0.5rem 0 0;
-  padding-left: 1.1rem;
+.badge {
+  padding: 4px 10px;
+  border-radius: 999px;
   font-size: 0.75rem;
-  opacity: 0.85;
+  font-weight: 700;
+  text-transform: uppercase;
+  letter-spacing: 0.04em;
+}
+
+.badge-weak {
+  background: rgba(220, 38, 38, 0.15);
+  color: var(--danger);
+}
+
+.badge-medium {
+  background: rgba(245, 158, 11, 0.18);
+  color: var(--warning);
+}
+
+.badge-strong {
+  background: rgba(22, 163, 74, 0.18);
+  color: var(--success);
 }
 
-.actions {
+.tips h3 {
+  margin: 0;
+  font-size: 0.95rem;
+}
+
+.tips ul {
+  margin: 4px 0 0;
+  padding-left: 20px;
+  display: none;
+  color: var(--text);
+}
+
+.tips ul.visible {
+  display: block;
+}
+
+.empty-state {
+  margin: 6px 0 0;
+  color: var(--text-muted);
+  font-size: 0.85rem;
+}
+
+.hibp-card {
+  display: flex;
+  flex-direction: column;
+  gap: 10px;
+  padding: 14px;
+  border-radius: 14px;
+  background: var(--surface-muted);
+  border: 1px dashed rgba(59, 130, 246, 0.35);
+}
+
+.hibp-card h3 {
+  margin: 0 0 2px;
+  font-size: 0.95rem;
+}
+
+.hibp-card p {
+  margin: 0;
+  color: var(--text-muted);
+  font-size: 0.8rem;
+}
+
+.hibp-actions {
   display: flex;
   align-items: center;
-  gap: 0.5rem;
-  margin-top: 1rem;
+  gap: 12px;
+  flex-wrap: wrap;
 }
 
-.actions #hibpResult {
-  font-size: 0.75rem;
-  flex: 1;
+.generator-actions {
+  display: flex;
+  align-items: center;
+  gap: 12px;
+  flex-wrap: wrap;
 }
 
-.vault {
-  margin-top: 1.25rem;
-  background: var(--card);
-  padding: 0.75rem;
-  border-radius: 8px;
+.generator-actions span {
+  color: var(--text-muted);
+  font-size: 0.8rem;
 }
 
-.vault h2 {
-  margin: 0 0 0.5rem;
-  font-size: 1rem;
+.generated-output {
+  display: flex;
+  flex-direction: column;
+  gap: 10px;
 }
 
-.vault-control,
-.vault-actions {
+.generated-actions {
   display: flex;
-  gap: 0.5rem;
-  margin-bottom: 0.5rem;
+  justify-content: flex-end;
 }
 
-.vault-control input,
-.vault-actions input {
-  flex: 1;
-  padding: 0.35rem 0.5rem;
-  border-radius: 6px;
-  border: 1px solid rgba(148, 163, 184, 0.3);
-  background: rgba(15, 23, 42, 0.4);
-  color: var(--foreground);
+.toast {
+  position: fixed;
+  inset-inline: 16px;
+  bottom: 16px;
+  padding: 12px 16px;
+  border-radius: 12px;
+  background: rgba(26, 31, 54, 0.9);
+  color: #ffffff;
+  font-size: 0.85rem;
+  opacity: 0;
+  transform: translateY(20px);
+  transition: opacity 0.25s ease, transform 0.25s ease;
+  pointer-events: none;
+  z-index: 100;
+}
+
+.toast.visible {
+  opacity: 1;
+  transform: translateY(0);
 }
 
-#vaultList {
+.toast.success {
+  background: rgba(22, 163, 74, 0.92);
+}
+
+.toast.error {
+  background: rgba(220, 38, 38, 0.92);
+}
+
+.toast.warning {
+  background: rgba(245, 158, 11, 0.92);
+  color: #0f172a;
+}
+
+.vault-toolbar {
+  display: flex;
+  flex-direction: column;
+  gap: 12px;
+}
+
+.vault-toolbar .search input {
+  background: var(--surface-muted);
+}
+
+.toolbar-actions {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 8px;
+  justify-content: flex-end;
+}
+
+.vault-list {
   list-style: none;
-  margin: 0;
   padding: 0;
-  max-height: 120px;
-  overflow-y: auto;
-  font-size: 0.75rem;
+  margin: 0;
+  display: flex;
+  flex-direction: column;
+  gap: 10px;
 }
 
-#vaultList li {
+.vault-item {
+  display: flex;
+  flex-direction: column;
+  gap: 10px;
+  padding: 14px;
+  border: 1px solid var(--border);
+  border-radius: 14px;
+  background: var(--surface-muted);
+  position: relative;
+}
+
+.vault-item header {
   display: flex;
   justify-content: space-between;
-  padding: 0.25rem 0;
-  border-bottom: 1px solid rgba(148, 163, 184, 0.1);
+  align-items: baseline;
+  gap: 12px;
 }
 
-footer {
-  margin-top: 1rem;
-  text-align: right;
+.vault-item h3 {
+  margin: 0;
+  font-size: 0.95rem;
 }
 
-footer a {
-  color: var(--accent);
-  font-size: 0.8rem;
-  text-decoration: none;
+.vault-item .meta {
+  margin: 0;
+  font-size: 0.75rem;
+  color: var(--text-muted);
+}
+
+.vault-item .username {
+  font-weight: 600;
+  font-size: 0.9rem;
+}
+
+.vault-actions {
+  display: flex;
+  gap: 8px;
+  flex-wrap: wrap;
+}
+
+.action-btn {
+  flex: 1 1 auto;
+  border-radius: 10px;
+  padding: 8px 10px;
+  border: 1px solid transparent;
+  background: rgba(59, 130, 246, 0.12);
+  color: var(--primary);
+  font-weight: 600;
+  cursor: pointer;
+}
+
+.action-btn.danger {
+  background: rgba(220, 38, 38, 0.1);
+  color: var(--danger);
+}
+
+.password-reveal {
+  font-family: 'Fira Code', 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
+  padding: 10px;
+  border-radius: 10px;
+  background: rgba(15, 118, 110, 0.08);
+  word-break: break-all;
+}
+
+.modal-backdrop {
+  position: fixed;
+  inset: 0;
+  background: rgba(12, 16, 28, 0.55);
+  z-index: 200;
+}
+
+.modal {
+  position: fixed;
+  inset: 0;
+  display: flex;
+  justify-content: center;
+  align-items: center;
+  z-index: 210;
+}
+
+.modal.hidden,
+.modal-backdrop.hidden {
+  display: none;
+}
+
+.modal-content {
+  background: var(--surface);
+  padding: 20px;
+  border-radius: 16px;
+  width: min(360px, calc(100% - 40px));
+  display: flex;
+  flex-direction: column;
+  gap: 12px;
+  border: 1px solid var(--border);
+  box-shadow: var(--shadow);
+}
+
+.modal-content header h3 {
+  margin: 0;
+  font-size: 1rem;
+}
+
+.modal-content header p {
+  margin: 4px 0 0;
+  font-size: 0.85rem;
+  color: var(--text-muted);
+}
+
+.modal-actions {
+  display: flex;
+  gap: 10px;
+  justify-content: flex-end;
+  margin-top: 8px;
+}
+
+.hidden {
+  display: none !important;
+}
+
+.stack {
+  display: flex;
+  flex-direction: column;
+  gap: 10px;
+}
+
+.vault-state h3 {
+  margin: 0 0 6px;
+}
+
+@media (prefers-reduced-motion: reduce) {
+  *,
+  *::before,
+  *::after {
+    animation-duration: 0.01ms !important;
+    animation-iteration-count: 1 !important;
+    transition-duration: 0.01ms !important;
+    scroll-behavior: auto !important;
+  }
 }
diff --git a/extension/popup/popup.html b/extension/popup/popup.html
index 335bb9506712e53463f49841c6fd9f27969d0655..9b5b3540b94622a68e48890456f2ba3e098b114c 100644
--- a/extension/popup/popup.html
+++ b/extension/popup/popup.html
@@ -1,61 +1,241 @@
 <!doctype html>
 <html lang="en">
   <head>
     <meta charset="utf-8" />
     <meta name="viewport" content="width=device-width, initial-scale=1" />
-    <title>SecurePass Assistant</title>
+    <title>SecurePass Suite</title>
     <link rel="stylesheet" href="popup.css" />
   </head>
   <body>
-    <header>
-      <h1>SecurePass Assistant</h1>
-      <button id="themeToggle" aria-label="Toggle theme">üåì</button>
-    </header>
-
-    <section class="input-section">
-      <label for="passwordInput">Test a password</label>
-      <div class="input-wrapper">
-        <input type="password" id="passwordInput" autocomplete="off" />
-        <button id="visibilityToggle" aria-label="Toggle visibility">üëÅÔ∏è</button>
-      </div>
-    </section>
-
-    <section class="strength-section">
-      <div class="meter">
-        <div id="strengthBar"></div>
-      </div>
-      <div class="meta">
-        <span id="verdict">Weak</span>
-        <span id="entropy">0 bits</span>
-        <span id="crackTime">Instant</span>
-      </div>
-      <ul id="suggestions"></ul>
-    </section>
-
-    <section class="actions">
-      <button id="checkHibp">Check HIBP</button>
-      <button id="generateCopy">Generate &amp; Copy</button>
-      <span id="hibpResult" role="status"></span>
-    </section>
-
-    <section class="vault">
-      <h2>Secure vault</h2>
-      <div class="vault-control">
-        <input type="password" id="vaultPassphrase" placeholder="Vault passphrase" />
-        <button id="unlockVault">Unlock</button>
-        <button id="lockVault">Lock</button>
-      </div>
-      <div class="vault-actions">
-        <input type="text" id="credentialLabel" placeholder="Label / username" />
-        <button id="saveCredential">Save current password</button>
-      </div>
-      <ul id="vaultList"></ul>
-    </section>
-
-    <footer>
-      <a href="../options/options.html" target="_blank">Settings</a>
-    </footer>
+    <div class="app">
+      <header class="app-header">
+        <div class="brand">
+          <span aria-hidden="true" class="brand-icon">üîê</span>
+          <div>
+            <h1>SecurePass Suite</h1>
+            <p class="subtitle">Test, generate and safeguard your passwords</p>
+          </div>
+        </div>
+        <button id="themeToggle" class="icon-button" aria-label="Toggle theme" title="Toggle theme">
+          üåì
+        </button>
+      </header>
+
+      <nav class="view-switcher" role="tablist">
+        <button class="tab active" role="tab" aria-selected="true" data-view="tester">
+          Tester &amp; Generator
+        </button>
+        <button class="tab" role="tab" aria-selected="false" data-view="vault">
+          Secure Vault
+        </button>
+      </nav>
+
+      <main>
+        <section id="view-tester" class="view active" role="tabpanel" aria-labelledby="Tester &amp; Generator">
+          <div class="panel">
+            <div class="panel-header">
+              <h2>Password tester</h2>
+              <p>Understand how resilient your password is with live insights.</p>
+            </div>
+            <div class="field-group">
+              <label for="passwordInput">Password to analyse</label>
+              <div class="input-with-actions">
+                <input type="password" id="passwordInput" autocomplete="off" />
+                <button id="togglePassword" class="icon-button" type="button" aria-label="Show password">üëÅÔ∏è</button>
+                <button id="copyTestPassword" class="icon-button" type="button" aria-label="Copy password">üìã</button>
+              </div>
+            </div>
+            <div class="strength-meter" aria-live="polite">
+              <div class="meter-track">
+                <div id="strengthBar" class="meter-bar"></div>
+              </div>
+              <div class="meter-labels">
+                <span id="strengthVerdict" class="badge badge-weak">Weak</span>
+                <span id="entropy">Entropy: 0 bits</span>
+                <span id="crackTime">Crack time: Instant</span>
+              </div>
+            </div>
+            <div class="tips">
+              <h3>How to improve it</h3>
+              <ul id="suggestionsList"></ul>
+              <p id="suggestionsEmpty" class="empty-state">Start typing to see personalised tips.</p>
+            </div>
+            <div class="hibp-card">
+              <div>
+                <h3>Breached password check</h3>
+                <p>We use Have I Been Pwned with k-anonymity. Only a secure prefix is shared.</p>
+              </div>
+              <div class="hibp-actions">
+                <button id="checkHibp" type="button" class="primary">Check now</button>
+                <span id="hibpStatus" role="status" aria-live="polite">Not checked yet.</span>
+              </div>
+            </div>
+          </div>
+
+          <div class="panel">
+            <div class="panel-header">
+              <h2>Password generator</h2>
+              <p>Create unique passwords tailored to your needs.</p>
+            </div>
+            <div class="generator-controls">
+              <div class="field-group">
+                <label for="lengthRange">Length: <span id="lengthValue">16</span> characters</label>
+                <input type="range" id="lengthRange" min="8" max="64" value="16" />
+              </div>
+              <div class="field-group check-grid">
+                <label class="checkbox">
+                  <input type="checkbox" id="includeLower" checked />
+                  <span>Lowercase</span>
+                </label>
+                <label class="checkbox">
+                  <input type="checkbox" id="includeUpper" checked />
+                  <span>Uppercase</span>
+                </label>
+                <label class="checkbox">
+                  <input type="checkbox" id="includeNumbers" checked />
+                  <span>Numbers</span>
+                </label>
+                <label class="checkbox">
+                  <input type="checkbox" id="includeSymbols" checked />
+                  <span>Symbols</span>
+                </label>
+                <label class="checkbox">
+                  <input type="checkbox" id="avoidSimilar" checked />
+                  <span>Avoid look-alikes</span>
+                </label>
+              </div>
+            </div>
+            <div class="generator-actions">
+              <button id="generatePassword" type="button" class="primary">Generate password</button>
+              <span id="generatorStatus" role="status" aria-live="polite"></span>
+            </div>
+            <div class="generated-output">
+              <label for="generatedResult">Generated password</label>
+              <div class="input-with-actions">
+                <input type="text" id="generatedResult" readonly />
+                <button id="copyGenerated" class="icon-button" type="button" aria-label="Copy generated password">üìã</button>
+                <button id="useForTest" class="icon-button" type="button" aria-label="Use in tester">‚û°Ô∏è</button>
+              </div>
+              <div class="generated-actions">
+                <button id="saveGenerated" type="button" class="secondary">Save to vault</button>
+              </div>
+            </div>
+          </div>
+        </section>
+
+        <section id="view-vault" class="view" role="tabpanel" aria-labelledby="Secure Vault">
+          <div id="vaultLocked" class="panel">
+            <div class="panel-header">
+              <h2>Secure vault</h2>
+              <p>Unlock with your master password to view and manage saved credentials.</p>
+            </div>
+            <div id="createMaster" class="vault-state hidden">
+              <h3>Create a master password</h3>
+              <p>This password encrypts your vault before it is synced. Choose something memorable and strong.</p>
+              <form id="createMasterForm" class="stack">
+                <label>
+                  Master password
+                  <input type="password" id="newMaster" autocomplete="new-password" required />
+                </label>
+                <label>
+                  Confirm master password
+                  <input type="password" id="confirmMaster" autocomplete="new-password" required />
+                </label>
+                <button type="submit" class="primary">Create vault</button>
+              </form>
+            </div>
+            <div id="unlockMaster" class="vault-state">
+              <h3>Unlock your vault</h3>
+              <form id="unlockForm" class="stack">
+                <label>
+                  Master password
+                  <input type="password" id="vaultPassphrase" autocomplete="current-password" required />
+                </label>
+                <button type="submit" class="primary">Unlock</button>
+              </form>
+            </div>
+          </div>
+
+          <div id="vaultUnlocked" class="panel hidden">
+            <div class="panel-header">
+              <h2>Your stored credentials</h2>
+              <p>Passwords stay encrypted locally and in sync across your devices.</p>
+            </div>
+            <div class="vault-toolbar">
+              <div class="search">
+                <label for="vaultSearch">Search</label>
+                <input type="search" id="vaultSearch" placeholder="Site or username" />
+              </div>
+              <div class="toolbar-actions">
+                <button id="addEntry" type="button" class="primary">Add credential</button>
+                <button id="changeMaster" type="button" class="secondary">Change master password</button>
+                <button id="lockVault" type="button" class="icon-button" title="Lock vault" aria-label="Lock vault">üîí</button>
+              </div>
+            </div>
+            <ul id="vaultList" class="vault-list"></ul>
+            <p id="vaultEmpty" class="empty-state hidden">No credentials saved yet.</p>
+          </div>
+        </section>
+      </main>
+    </div>
+
+    <div id="toast" class="toast" role="status" aria-live="polite"></div>
+    <div id="modalBackdrop" class="modal-backdrop hidden" aria-hidden="true"></div>
+
+    <div id="entryModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="entryModalTitle">
+      <form id="entryForm" class="modal-content">
+        <header>
+          <h3 id="entryModalTitle">Save credential</h3>
+          <p>Only encrypted data leaves this device. Fill in the details below.</p>
+        </header>
+        <label>
+          Website or app
+          <input type="text" id="entrySite" placeholder="https://example.com" required />
+        </label>
+        <label>
+          Username or email
+          <input type="text" id="entryUsername" placeholder="user@example.com" />
+        </label>
+        <label>
+          Password
+          <input type="text" id="entryPassword" required />
+        </label>
+        <label>
+          Notes (optional)
+          <textarea id="entryNotes" rows="2" placeholder="Additional context" ></textarea>
+        </label>
+        <div class="modal-actions">
+          <button type="submit" class="primary">Save</button>
+          <button type="button" data-close="entryModal" class="secondary">Cancel</button>
+        </div>
+      </form>
+    </div>
+
+    <div id="masterModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="masterModalTitle">
+      <form id="masterForm" class="modal-content">
+        <header>
+          <h3 id="masterModalTitle">Change master password</h3>
+          <p>We will re-encrypt the vault with your new master password immediately.</p>
+        </header>
+        <label>
+          Current master password
+          <input type="password" id="currentMaster" autocomplete="current-password" required />
+        </label>
+        <label>
+          New master password
+          <input type="password" id="nextMaster" autocomplete="new-password" required />
+        </label>
+        <label>
+          Confirm new master password
+          <input type="password" id="confirmNextMaster" autocomplete="new-password" required />
+        </label>
+        <div class="modal-actions">
+          <button type="submit" class="primary">Update master password</button>
+          <button type="button" data-close="masterModal" class="secondary">Cancel</button>
+        </div>
+      </form>
+    </div>
 
     <script type="module" src="popup.js"></script>
   </body>
 </html>
diff --git a/extension/popup/popup.js b/extension/popup/popup.js
index d6045f8fb3720f38c69c710bcf9a58d71608fbf9..87234645aaf6a768a4362fa8c9d1796c13f7625c 100644
--- a/extension/popup/popup.js
+++ b/extension/popup/popup.js
@@ -1,246 +1,845 @@
 import { evaluatePassword } from '../src/passwordStrength.js';
 import { loadSettings, saveSettings } from '../src/settings.js';
 
 const passwordInput = document.getElementById('passwordInput');
 const strengthBar = document.getElementById('strengthBar');
-const verdictEl = document.getElementById('verdict');
+const strengthVerdict = document.getElementById('strengthVerdict');
 const entropyEl = document.getElementById('entropy');
 const crackTimeEl = document.getElementById('crackTime');
-const suggestionsEl = document.getElementById('suggestions');
-const hibpResult = document.getElementById('hibpResult');
-const generateButton = document.getElementById('generateCopy');
-const checkButton = document.getElementById('checkHibp');
-const visibilityToggle = document.getElementById('visibilityToggle');
+const suggestionsList = document.getElementById('suggestionsList');
+const suggestionsEmpty = document.getElementById('suggestionsEmpty');
+const hibpStatus = document.getElementById('hibpStatus');
+const hibpButton = document.getElementById('checkHibp');
+const togglePasswordBtn = document.getElementById('togglePassword');
+const copyTestPasswordBtn = document.getElementById('copyTestPassword');
 const themeToggle = document.getElementById('themeToggle');
-const vaultPassphrase = document.getElementById('vaultPassphrase');
-const unlockVaultBtn = document.getElementById('unlockVault');
-const lockVaultBtn = document.getElementById('lockVault');
-const saveCredentialBtn = document.getElementById('saveCredential');
+const toastEl = document.getElementById('toast');
+const viewTabs = document.querySelectorAll('.tab');
+const views = {
+  tester: document.getElementById('view-tester'),
+  vault: document.getElementById('view-vault')
+};
+
+const lengthRange = document.getElementById('lengthRange');
+const lengthValue = document.getElementById('lengthValue');
+const includeLower = document.getElementById('includeLower');
+const includeUpper = document.getElementById('includeUpper');
+const includeNumbers = document.getElementById('includeNumbers');
+const includeSymbols = document.getElementById('includeSymbols');
+const avoidSimilar = document.getElementById('avoidSimilar');
+const generatorStatus = document.getElementById('generatorStatus');
+const generateButton = document.getElementById('generatePassword');
+const generatedResult = document.getElementById('generatedResult');
+const copyGeneratedBtn = document.getElementById('copyGenerated');
+const useForTestBtn = document.getElementById('useForTest');
+const saveGeneratedBtn = document.getElementById('saveGenerated');
+
+const vaultLockedPanel = document.getElementById('vaultLocked');
+const vaultUnlockedPanel = document.getElementById('vaultUnlocked');
+const createMasterSection = document.getElementById('createMaster');
+const unlockMasterSection = document.getElementById('unlockMaster');
+const createMasterForm = document.getElementById('createMasterForm');
+const unlockForm = document.getElementById('unlockForm');
+const vaultPassphraseInput = document.getElementById('vaultPassphrase');
+const newMasterInput = document.getElementById('newMaster');
+const confirmMasterInput = document.getElementById('confirmMaster');
 const vaultList = document.getElementById('vaultList');
-const credentialLabel = document.getElementById('credentialLabel');
+const vaultEmpty = document.getElementById('vaultEmpty');
+const vaultSearch = document.getElementById('vaultSearch');
+const addEntryBtn = document.getElementById('addEntry');
+const changeMasterBtn = document.getElementById('changeMaster');
+const lockVaultBtn = document.getElementById('lockVault');
+
+const modalBackdrop = document.getElementById('modalBackdrop');
+const entryModal = document.getElementById('entryModal');
+const entryForm = document.getElementById('entryForm');
+const entryModalTitle = document.getElementById('entryModalTitle');
+const entrySiteInput = document.getElementById('entrySite');
+const entryUsernameInput = document.getElementById('entryUsername');
+const entryPasswordInput = document.getElementById('entryPassword');
+const entryNotesInput = document.getElementById('entryNotes');
+
+const masterModal = document.getElementById('masterModal');
+const masterForm = document.getElementById('masterForm');
+const currentMasterInput = document.getElementById('currentMaster');
+const nextMasterInput = document.getElementById('nextMaster');
+const confirmNextMasterInput = document.getElementById('confirmNextMaster');
+
+const THEMES = ['system', 'dark', 'light'];
+const revealTimers = new Map();
+let settingsSaveTimeout = null;
 
 const state = {
   settings: null,
   vaultUnlocked: false,
-  passphrase: null
+  vaultInitialized: null,
+  passphrase: null,
+  entries: [],
+  filter: '',
+  generatorPassword: '',
+  inactivityTimer: null,
+  currentView: 'tester',
+  editingEntryId: null
 };
 
-const THEMES = ['system', 'dark', 'light'];
-
 function systemPrefersDark() {
   return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
 }
 
+function resolveTheme(theme) {
+  if (theme === 'system') {
+    return systemPrefersDark() ? 'dark' : 'light';
+  }
+  return theme;
+}
+
 function applyTheme(theme) {
-  const resolved = theme === 'system' ? (systemPrefersDark() ? 'dark' : 'light') : theme;
+  const resolved = resolveTheme(theme);
   document.body.dataset.theme = resolved;
 }
 
-function mapScoreToColor(score) {
-  if (score >= 0.8) return 'var(--success)';
-  if (score >= 0.6) return '#4ade80';
-  if (score >= 0.4) return 'var(--warning)';
-  return 'var(--danger)';
+function scheduleSettingsSave() {
+  if (!state.settings) return;
+  clearTimeout(settingsSaveTimeout);
+  settingsSaveTimeout = setTimeout(() => {
+    saveSettings(state.settings).catch(() => {
+      showToast('Unable to save preferences.', 'warning');
+    });
+  }, 250);
 }
 
-async function loadInitialSettings() {
-  state.settings = await loadSettings();
-  if (!state.settings.theme) {
-    state.settings.theme = 'system';
-  }
-  applyTheme(state.settings.theme);
-  if (state.settings.theme === 'system' && window.matchMedia) {
-    window
-      .matchMedia('(prefers-color-scheme: dark)')
-      .addEventListener('change', () => applyTheme('system'));
+function showToast(message, variant = 'info') {
+  if (!toastEl) return;
+  toastEl.textContent = message;
+  toastEl.classList.remove('visible', 'success', 'error', 'warning');
+  if (variant !== 'info') {
+    toastEl.classList.add(variant);
   }
+  requestAnimationFrame(() => {
+    toastEl.classList.add('visible');
+  });
+  setTimeout(() => {
+    toastEl.classList.remove('visible', 'success', 'error', 'warning');
+  }, 3200);
+}
+
+function mapScoreToColor(score) {
+  if (score >= 0.8) return 'linear-gradient(90deg, #22c55e, #16a34a)';
+  if (score >= 0.6) return 'linear-gradient(90deg, #84cc16, #16a34a)';
+  if (score >= 0.4) return 'linear-gradient(90deg, #f97316, #f59e0b)';
+  return 'linear-gradient(90deg, #ef4444, #dc2626)';
+}
+
+function scoreToBadge(score) {
+  if (score >= 0.75) return 'badge-strong';
+  if (score >= 0.45) return 'badge-medium';
+  return 'badge-weak';
 }
 
 function updateStrength(password) {
-  const result = evaluatePassword(password);
-  strengthBar.style.width = `${Math.max(result.score * 100, 6)}%`;
-  strengthBar.style.background = mapScoreToColor(result.score);
-  verdictEl.textContent = result.verdict;
-  entropyEl.textContent = `${result.entropy} bits`;
-  crackTimeEl.textContent = result.crackTime;
+  const { score, verdict, entropy, crackTime, suggestions } = evaluatePassword(password);
+  strengthBar.style.width = `${Math.max(score * 100, 6)}%`;
+  strengthBar.style.background = mapScoreToColor(score);
+  strengthVerdict.textContent = verdict;
+  strengthVerdict.classList.remove('badge-weak', 'badge-medium', 'badge-strong');
+  strengthVerdict.classList.add(scoreToBadge(score));
+  entropyEl.textContent = `Entropy: ${entropy} bits`;
+  crackTimeEl.textContent = `Crack time: ${crackTime}`;
 
-  suggestionsEl.innerHTML = '';
-  result.suggestions.forEach(suggestion => {
-    const li = document.createElement('li');
-    li.textContent = suggestion;
-    suggestionsEl.appendChild(li);
-  });
+  suggestionsList.innerHTML = '';
+  if (suggestions.length) {
+    suggestionsEmpty.classList.add('hidden');
+    suggestionsList.classList.add('visible');
+    suggestions.forEach(tip => {
+      const li = document.createElement('li');
+      li.textContent = tip;
+      suggestionsList.appendChild(li);
+    });
+  } else {
+    suggestionsList.classList.remove('visible');
+    suggestionsEmpty.classList.remove('hidden');
+  }
 }
 
 function setLoading(button, loading) {
+  if (!button) return;
   button.disabled = loading;
   button.dataset.loading = loading;
 }
 
 async function sendMessage(type, payload = {}) {
   return new Promise(resolve => {
     chrome.runtime.sendMessage({ type, ...payload }, response => {
-      resolve(response);
+      resolve(response || { ok: false, error: 'No response from background.' });
     });
   });
 }
 
-passwordInput.addEventListener('input', event => {
-  updateStrength(event.target.value);
-  hibpResult.textContent = '';
-});
+async function copyToClipboard(value) {
+  try {
+    await navigator.clipboard.writeText(value);
+    return true;
+  } catch (error) {
+    return false;
+  }
+}
 
-visibilityToggle.addEventListener('click', () => {
-  if (passwordInput.type === 'password') {
-    passwordInput.type = 'text';
-    visibilityToggle.textContent = 'üôà';
-  } else {
-    passwordInput.type = 'password';
-    visibilityToggle.textContent = 'üëÅÔ∏è';
+function setView(view) {
+  state.currentView = view;
+  viewTabs.forEach(tab => {
+    const isActive = tab.dataset.view === view;
+    tab.classList.toggle('active', isActive);
+    tab.setAttribute('aria-selected', isActive ? 'true' : 'false');
+  });
+  Object.entries(views).forEach(([key, section]) => {
+    section.classList.toggle('active', key === view);
+  });
+}
+
+function resetInactivityTimer() {
+  if (!state.vaultUnlocked) return;
+  const minutes = state.settings?.vaultTimeout || 15;
+  clearTimeout(state.inactivityTimer);
+  state.inactivityTimer = setTimeout(async () => {
+    await lockVault();
+    showToast('Vault locked after inactivity.', 'warning');
+  }, minutes * 60 * 1000);
+}
+
+async function detectActiveOrigin() {
+  try {
+    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
+    if (tab?.url) {
+      return new URL(tab.url).origin;
+    }
+  } catch (error) {
+    // ignore
+  }
+  return '';
+}
+
+function clearRevealTimer(id) {
+  const timer = revealTimers.get(id);
+  if (timer) {
+    clearTimeout(timer);
+    revealTimers.delete(id);
+  }
+}
+
+function hidePasswordReveal(container, button, id) {
+  if (!container) return;
+  container.classList.add('hidden');
+  container.textContent = '';
+  if (button) button.textContent = 'Reveal';
+  if (id) clearRevealTimer(id);
+}
+
+function renderVaultEntries() {
+  if (!state.vaultUnlocked) {
+    vaultList.innerHTML = '';
+    vaultEmpty.classList.add('hidden');
+    return;
   }
-});
+  const query = state.filter.toLowerCase();
+  const filtered = state.entries
+    .slice()
+    .filter(entry => {
+      if (!query) return true;
+      return (
+        entry.site.toLowerCase().includes(query) ||
+        entry.username.toLowerCase().includes(query)
+      );
+    })
+    .sort((a, b) => {
+      const siteCompare = a.site.localeCompare(b.site, undefined, { sensitivity: 'base' });
+      if (siteCompare !== 0) return siteCompare;
+      return a.username.localeCompare(b.username, undefined, { sensitivity: 'base' });
+    });
 
-checkButton.addEventListener('click', async () => {
-  setLoading(checkButton, true);
-  hibpResult.textContent = 'Checking‚Ä¶';
-  const { result, ok, error } = await sendMessage('HIBP_CHECK', { password: passwordInput.value });
-  setLoading(checkButton, false);
-  if (!ok) {
-    hibpResult.textContent = error || 'HIBP check failed.';
-    hibpResult.style.color = 'var(--warning)';
+  vaultList.innerHTML = '';
+  if (!filtered.length) {
+    vaultEmpty.classList.remove('hidden');
     return;
   }
-  if (result.compromised) {
-    hibpResult.textContent = `Compromised ${result.count.toLocaleString()} times!`;
-    hibpResult.style.color = 'var(--danger)';
+  vaultEmpty.classList.add('hidden');
+
+  filtered.forEach(entry => {
+    const item = document.createElement('li');
+    item.className = 'vault-item';
+    item.dataset.id = entry.id;
+
+    const header = document.createElement('header');
+    const title = document.createElement('h3');
+    title.textContent = entry.site || 'Untitled';
+    header.appendChild(title);
+
+    const meta = document.createElement('p');
+    meta.className = 'meta';
+    const updated = new Date(entry.updatedAt || entry.createdAt);
+    meta.textContent = `Updated ${updated.toLocaleString()}`;
+    header.appendChild(meta);
+
+    item.appendChild(header);
+
+    if (entry.username) {
+      const username = document.createElement('div');
+      username.className = 'username';
+      username.textContent = entry.username;
+      item.appendChild(username);
+    }
+
+    if (entry.notes) {
+      const notes = document.createElement('p');
+      notes.className = 'meta';
+      notes.textContent = entry.notes;
+      item.appendChild(notes);
+    }
+
+    const passwordReveal = document.createElement('div');
+    passwordReveal.className = 'password-reveal hidden';
+    item.appendChild(passwordReveal);
+
+    const actions = document.createElement('div');
+    actions.className = 'vault-actions';
+
+    const revealBtn = document.createElement('button');
+    revealBtn.type = 'button';
+    revealBtn.className = 'action-btn';
+    revealBtn.textContent = 'Reveal';
+    revealBtn.addEventListener('click', () => {
+      resetInactivityTimer();
+      const isHidden = passwordReveal.classList.contains('hidden');
+      if (isHidden) {
+        passwordReveal.textContent = entry.password;
+        passwordReveal.classList.remove('hidden');
+        revealBtn.textContent = 'Hide';
+        clearRevealTimer(entry.id);
+        const timer = setTimeout(() => {
+          hidePasswordReveal(passwordReveal, revealBtn, entry.id);
+        }, 10000);
+        revealTimers.set(entry.id, timer);
+      } else {
+        hidePasswordReveal(passwordReveal, revealBtn, entry.id);
+      }
+    });
+
+    const copyBtn = document.createElement('button');
+    copyBtn.type = 'button';
+    copyBtn.className = 'action-btn';
+    copyBtn.textContent = 'Copy';
+    copyBtn.addEventListener('click', async () => {
+      resetInactivityTimer();
+      const ok = await copyToClipboard(entry.password);
+      showToast(ok ? 'Password copied to clipboard.' : 'Unable to copy password.', ok ? 'success' : 'warning');
+    });
+
+    const editBtn = document.createElement('button');
+    editBtn.type = 'button';
+    editBtn.className = 'action-btn';
+    editBtn.textContent = 'Edit';
+    editBtn.addEventListener('click', () => {
+      openEntryModal(entry);
+    });
+
+    const deleteBtn = document.createElement('button');
+    deleteBtn.type = 'button';
+    deleteBtn.className = 'action-btn danger';
+    deleteBtn.textContent = 'Delete';
+    deleteBtn.addEventListener('click', async () => {
+      const confirmed = window.confirm('Delete this credential from the vault?');
+      if (!confirmed) return;
+      await deleteCredential(entry.id);
+    });
+
+    actions.append(revealBtn, copyBtn, editBtn, deleteBtn);
+    item.appendChild(actions);
+    vaultList.appendChild(item);
+  });
+}
+
+function renderVaultState() {
+  const showLocked = !state.vaultUnlocked;
+  vaultLockedPanel.classList.toggle('hidden', !showLocked);
+  vaultUnlockedPanel.classList.toggle('hidden', showLocked);
+  createMasterSection.classList.toggle('hidden', state.vaultInitialized !== false);
+  unlockMasterSection.classList.toggle('hidden', !state.vaultInitialized);
+  if (!state.vaultUnlocked) {
+    vaultSearch.value = '';
+    state.filter = '';
+    state.entries = [];
+  }
+}
+
+function clearEntryForm() {
+  entryForm.reset();
+  entrySiteInput.value = '';
+  entryUsernameInput.value = '';
+  entryPasswordInput.value = '';
+  entryNotesInput.value = '';
+}
+
+function closeModal(id) {
+  const modal = id === 'entryModal' ? entryModal : masterModal;
+  if (!modal.classList.contains('hidden')) {
+    modal.classList.add('hidden');
+  }
+  if (!entryModal.classList.contains('hidden') || !masterModal.classList.contains('hidden')) {
+    return;
+  }
+  modalBackdrop.classList.add('hidden');
+}
+
+function openModal(id) {
+  modalBackdrop.classList.remove('hidden');
+  const modal = id === 'entryModal' ? entryModal : masterModal;
+  modal.classList.remove('hidden');
+  const focusTarget = modal.querySelector('input, textarea, button');
+  if (focusTarget) {
+    setTimeout(() => focusTarget.focus(), 10);
+  }
+}
+
+async function openEntryModal(entry = null) {
+  if (!requireUnlockedVault()) return;
+  state.editingEntryId = entry ? entry.id : null;
+  entryModalTitle.textContent = entry ? 'Update credential' : 'Save credential';
+  clearEntryForm();
+  if (entry) {
+    entrySiteInput.value = entry.site || '';
+    entryUsernameInput.value = entry.username || '';
+    entryPasswordInput.value = entry.password || '';
+    entryNotesInput.value = entry.notes || '';
   } else {
-    hibpResult.textContent = 'Not found in breaches.';
-    hibpResult.style.color = 'var(--success)';
+    entryPasswordInput.value = state.generatorPassword || passwordInput.value;
+    if (!entrySiteInput.value) {
+      entrySiteInput.value = await detectActiveOrigin();
+    }
   }
-});
+  openModal('entryModal');
+  resetInactivityTimer();
+}
 
-generateButton.addEventListener('click', async () => {
-  setLoading(generateButton, true);
-  const { password, ok, error } = await sendMessage('GENERATE_PASSWORD', { constraints: {} });
-  setLoading(generateButton, false);
-  if (!ok) {
-    hibpResult.textContent = error || 'Unable to generate password.';
-    hibpResult.style.color = 'var(--warning)';
+function openMasterModal() {
+  if (!requireUnlockedVault()) return;
+  masterForm.reset();
+  openModal('masterModal');
+  resetInactivityTimer();
+}
+
+function requireUnlockedVault() {
+  if (state.vaultUnlocked && state.passphrase) {
+    resetInactivityTimer();
+    return true;
+  }
+  showToast('Unlock the vault first to continue.', 'warning');
+  setView('vault');
+  return false;
+}
+
+async function lockVault(showMessage = false) {
+  await sendMessage('LOCK_VAULT');
+  state.vaultUnlocked = false;
+  state.passphrase = null;
+  state.entries = [];
+  clearTimeout(state.inactivityTimer);
+  renderVaultState();
+  renderVaultEntries();
+  if (showMessage) {
+    showToast('Vault locked.', 'info');
+  }
+}
+
+async function refreshVaultEntries() {
+  if (!state.vaultUnlocked) return;
+  const response = await sendMessage('LIST_CREDENTIALS');
+  if (!response?.ok) {
     return;
   }
-  passwordInput.value = password;
-  updateStrength(password);
-  try {
-    await navigator.clipboard.writeText(password);
-    hibpResult.textContent = 'Generated and copied!';
-    hibpResult.style.color = 'var(--accent)';
-  } catch (err) {
-    hibpResult.textContent = 'Generated. Copy manually.';
-    hibpResult.style.color = 'var(--warning)';
+  if (!response.unlocked) {
+    await lockVault();
+    return;
   }
-});
+  state.entries = response.entries || [];
+  renderVaultEntries();
+}
 
-async function refreshVaultList() {
-  const { ok, entries, unlocked } = await sendMessage('LIST_CREDENTIALS');
-  if (!ok) {
-    vaultList.innerHTML = '<li>Unlock vault to view entries.</li>';
+async function deleteCredential(id) {
+  if (!requireUnlockedVault()) return;
+  const response = await sendMessage('DELETE_CREDENTIAL', {
+    id,
+    passphrase: state.passphrase
+  });
+  if (!response?.ok) {
+    showToast(response?.error || 'Unable to delete credential.', 'error');
     return;
   }
-  if (!unlocked) {
-    vaultList.innerHTML = '<li>Vault locked.</li>';
+  showToast('Credential removed from vault.', 'success');
+  await refreshVaultEntries();
+  resetInactivityTimer();
+}
+
+async function handleEntrySubmit(event) {
+  event.preventDefault();
+  if (!requireUnlockedVault()) return;
+  const site = entrySiteInput.value.trim();
+  const username = entryUsernameInput.value.trim();
+  const password = entryPasswordInput.value.trim();
+  const notes = entryNotesInput.value.trim();
+
+  if (!site) {
+    showToast('Website or app is required.', 'warning');
+    entrySiteInput.focus();
     return;
   }
-  if (!entries.length) {
-    vaultList.innerHTML = '<li>No credentials stored yet.</li>';
+  if (!password) {
+    showToast('Password is required.', 'warning');
+    entryPasswordInput.focus();
     return;
   }
-  vaultList.innerHTML = '';
-  entries
-    .slice(-10)
-    .reverse()
-    .forEach(item => {
-      const li = document.createElement('li');
-      li.innerHTML = `<span>${item.label || item.origin}</span><span>${new Date(item.createdAt).toLocaleString()}</span>`;
-      vaultList.appendChild(li);
+
+  const payload = {
+    site,
+    username,
+    password,
+    notes
+  };
+
+  let response;
+  if (state.editingEntryId) {
+    response = await sendMessage('UPDATE_CREDENTIAL', {
+      id: state.editingEntryId,
+      updates: payload,
+      passphrase: state.passphrase
+    });
+  } else {
+    response = await sendMessage('STORE_CREDENTIAL', {
+      entry: payload,
+      passphrase: state.passphrase
     });
+  }
+
+  if (!response?.ok) {
+    showToast(response?.error || 'Unable to save credential.', 'error');
+    return;
+  }
+
+  closeModal('entryModal');
+  showToast(state.editingEntryId ? 'Credential updated.' : 'Credential saved to vault.', 'success');
+  state.editingEntryId = null;
+  await refreshVaultEntries();
+  resetInactivityTimer();
 }
 
-unlockVaultBtn.addEventListener('click', async () => {
-  const passphrase = vaultPassphrase.value.trim();
+async function handleUnlock(event) {
+  event.preventDefault();
+  const passphrase = vaultPassphraseInput.value.trim();
   if (!passphrase) return;
-  const { ok, data, error } = await sendMessage('UNLOCK_VAULT', {
-    passphrase,
-    timeoutMinutes: state.settings?.vaultTimeout || 15
-  });
-  if (!ok) {
-    hibpResult.textContent = error || 'Unable to unlock vault.';
-    hibpResult.style.color = 'var(--warning)';
+  const timeoutMinutes = state.settings?.vaultTimeout || 15;
+  const response = await sendMessage('UNLOCK_VAULT', { passphrase, timeoutMinutes });
+  if (!response?.ok) {
+    showToast(response?.error || 'Unable to unlock vault.', 'error');
     return;
   }
-  state.vaultUnlocked = true;
   state.passphrase = passphrase;
-  vaultPassphrase.value = '';
-  hibpResult.textContent = 'Vault unlocked.';
-  hibpResult.style.color = 'var(--success)';
-  if (data.entries) {
-    await refreshVaultList();
+  state.vaultUnlocked = true;
+  state.vaultInitialized = true;
+  vaultPassphraseInput.value = '';
+  state.entries = response.data?.entries || [];
+  renderVaultState();
+  renderVaultEntries();
+  resetInactivityTimer();
+  showToast('Vault unlocked.', 'success');
+}
+
+async function handleCreateMaster(event) {
+  event.preventDefault();
+  const master = newMasterInput.value.trim();
+  const confirm = confirmMasterInput.value.trim();
+  if (!master || !confirm) {
+    showToast('Enter and confirm the master password.', 'warning');
+    return;
+  }
+  if (master !== confirm) {
+    showToast('Master passwords do not match.', 'error');
+    return;
   }
-});
+  const initResponse = await sendMessage('INITIALIZE_VAULT', { passphrase: master });
+  if (!initResponse?.ok) {
+    showToast(initResponse?.error || 'Unable to initialise vault.', 'error');
+    return;
+  }
+  if (initResponse.created === false) {
+    state.vaultInitialized = true;
+    renderVaultState();
+    showToast('Vault already exists. Unlock it with your master password.', 'warning');
+    return;
+  }
+  const timeoutMinutes = state.settings?.vaultTimeout || 15;
+  const unlockResponse = await sendMessage('UNLOCK_VAULT', { passphrase: master, timeoutMinutes });
+  newMasterInput.value = '';
+  confirmMasterInput.value = '';
+  if (!unlockResponse?.ok) {
+    state.vaultInitialized = true;
+    renderVaultState();
+    showToast('Vault created. Unlock with your new master password.', 'success');
+    return;
+  }
+  state.passphrase = master;
+  state.vaultInitialized = true;
+  state.vaultUnlocked = true;
+  state.entries = unlockResponse.data?.entries || [];
+  renderVaultState();
+  renderVaultEntries();
+  resetInactivityTimer();
+  showToast('Vault created and unlocked.', 'success');
+}
 
-lockVaultBtn.addEventListener('click', async () => {
-  await sendMessage('LOCK_VAULT');
-  state.vaultUnlocked = false;
-  state.passphrase = null;
-  hibpResult.textContent = 'Vault locked.';
-  hibpResult.style.color = 'var(--warning)';
-  refreshVaultList();
-});
+async function loadVaultStatus() {
+  const response = await sendMessage('VAULT_STATUS');
+  if (!response?.ok) return;
+  state.vaultInitialized = response.status?.initialized ?? false;
+  if (response.status?.unlocked) {
+    await lockVault();
+  } else {
+    state.vaultUnlocked = false;
+    renderVaultState();
+  }
+}
+
+function syncGeneratorControls() {
+  if (!state.settings) return;
+  lengthRange.value = state.settings.minLength;
+  lengthValue.textContent = state.settings.minLength;
+  includeLower.checked = state.settings.includeLowercase;
+  includeUpper.checked = state.settings.includeUppercase;
+  includeNumbers.checked = state.settings.includeNumbers;
+  includeSymbols.checked = state.settings.includeSymbols;
+  avoidSimilar.checked = state.settings.avoidSimilar;
+}
 
-saveCredentialBtn.addEventListener('click', async () => {
-  if (!state.vaultUnlocked || !state.passphrase) {
-    hibpResult.textContent = 'Unlock vault first.';
-    hibpResult.style.color = 'var(--warning)';
+async function handleGenerate() {
+  setLoading(generateButton, true);
+  generatorStatus.textContent = '';
+  const constraints = {
+    length: Number(lengthRange.value),
+    overrides: {
+      minLength: Number(lengthRange.value),
+      includeLowercase: includeLower.checked,
+      includeUppercase: includeUpper.checked,
+      includeNumbers: includeNumbers.checked,
+      includeSymbols: includeSymbols.checked,
+      avoidSimilar: avoidSimilar.checked
+    }
+  };
+  const response = await sendMessage('GENERATE_PASSWORD', { constraints });
+  setLoading(generateButton, false);
+  if (!response?.ok) {
+    generatorStatus.textContent = response?.error || 'Could not generate password.';
+    generatorStatus.style.color = 'var(--danger)';
     return;
   }
-  if (!passwordInput.value) {
-    hibpResult.textContent = 'Enter or generate a password first.';
-    hibpResult.style.color = 'var(--warning)';
+  state.generatorPassword = response.password;
+  generatedResult.value = response.password;
+  generatorStatus.textContent = 'Strong password generated.';
+  generatorStatus.style.color = 'var(--primary)';
+  showToast('New password generated.', 'success');
+}
+
+async function saveGeneratedToVault() {
+  if (!generatedResult.value) {
+    showToast('Generate a password first.', 'warning');
     return;
   }
-  const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
-  const origin = tab && tab.url ? new URL(tab.url).origin : 'unknown';
-  const entry = {
-    origin,
-    label: credentialLabel.value || origin,
-    password: passwordInput.value
-  };
-  const { ok, error } = await sendMessage('STORE_CREDENTIAL', {
-    entry,
-    passphrase: state.passphrase
+  await openEntryModal({
+    id: null,
+    site: await detectActiveOrigin(),
+    username: '',
+    password: generatedResult.value,
+    notes: ''
+  });
+}
+
+async function changeMasterPassword(event) {
+  event.preventDefault();
+  if (!requireUnlockedVault()) return;
+  const current = currentMasterInput.value.trim();
+  const next = nextMasterInput.value.trim();
+  const confirm = confirmNextMasterInput.value.trim();
+  if (!current || !next || !confirm) {
+    showToast('Complete all fields.', 'warning');
+    return;
+  }
+  if (next !== confirm) {
+    showToast('New master passwords do not match.', 'error');
+    return;
+  }
+  const response = await sendMessage('CHANGE_MASTER_PASSWORD', {
+    oldPassphrase: current,
+    newPassphrase: next
   });
-  if (!ok) {
-    hibpResult.textContent = error || 'Failed to save credential.';
-    hibpResult.style.color = 'var(--warning)';
+  if (!response?.ok) {
+    showToast(response?.error || 'Unable to change master password.', 'error');
     return;
   }
-  credentialLabel.value = '';
-  hibpResult.textContent = 'Password stored securely.';
-  hibpResult.style.color = 'var(--success)';
-  refreshVaultList();
-});
-
-async function toggleTheme() {
-  if (!state.settings) return;
-  const currentIndex = THEMES.indexOf(state.settings.theme || 'system');
-  const nextTheme = THEMES[(currentIndex + 1) % THEMES.length];
-  state.settings.theme = nextTheme;
-  applyTheme(nextTheme);
-  await saveSettings(state.settings);
+  state.passphrase = next;
+  closeModal('masterModal');
+  resetInactivityTimer();
+  showToast('Master password updated.', 'success');
 }
 
-themeToggle.addEventListener('click', toggleTheme);
+function attachEventListeners() {
+  passwordInput.addEventListener('input', event => {
+    updateStrength(event.target.value);
+    hibpStatus.textContent = 'Not checked yet.';
+    hibpStatus.style.color = 'var(--text-muted)';
+  });
+
+  togglePasswordBtn.addEventListener('click', () => {
+    const isHidden = passwordInput.type === 'password';
+    passwordInput.type = isHidden ? 'text' : 'password';
+    togglePasswordBtn.textContent = isHidden ? 'üôà' : 'üëÅÔ∏è';
+  });
+
+  copyTestPasswordBtn.addEventListener('click', async () => {
+    if (!passwordInput.value) {
+      showToast('Enter a password first.', 'warning');
+      return;
+    }
+    const ok = await copyToClipboard(passwordInput.value);
+    showToast(ok ? 'Password copied.' : 'Clipboard unavailable.', ok ? 'success' : 'warning');
+  });
+
+  hibpButton.addEventListener('click', async () => {
+    if (!passwordInput.value) {
+      showToast('Enter a password to check.', 'warning');
+      return;
+    }
+    setLoading(hibpButton, true);
+    hibpStatus.textContent = 'Checking‚Ä¶';
+    hibpStatus.style.color = 'var(--text-muted)';
+    const response = await sendMessage('HIBP_CHECK', { password: passwordInput.value });
+    setLoading(hibpButton, false);
+    if (!response?.ok) {
+      hibpStatus.textContent = response?.error || 'Could not check breaches.';
+      hibpStatus.style.color = 'var(--warning)';
+      return;
+    }
+    if (response.result?.compromised) {
+      hibpStatus.textContent = `Compromised ${response.result.count.toLocaleString()} times.`;
+      hibpStatus.style.color = 'var(--danger)';
+      showToast('This password has appeared in breaches.', 'error');
+    } else {
+      hibpStatus.textContent = 'No known breaches found.';
+      hibpStatus.style.color = 'var(--success)';
+      showToast('Password not found in breaches.', 'success');
+    }
+  });
+
+  generateButton.addEventListener('click', handleGenerate);
+
+  lengthRange.addEventListener('input', event => {
+    lengthValue.textContent = event.target.value;
+  });
+
+  const generatorToggles = [includeLower, includeUpper, includeNumbers, includeSymbols, avoidSimilar];
+  generatorToggles.forEach(inputEl => {
+    inputEl.addEventListener('change', () => {
+      if (!state.settings) return;
+      state.settings.includeLowercase = includeLower.checked;
+      state.settings.includeUppercase = includeUpper.checked;
+      state.settings.includeNumbers = includeNumbers.checked;
+      state.settings.includeSymbols = includeSymbols.checked;
+      state.settings.avoidSimilar = avoidSimilar.checked;
+      scheduleSettingsSave();
+    });
+  });
+
+  lengthRange.addEventListener('change', () => {
+    if (!state.settings) return;
+    state.settings.minLength = Number(lengthRange.value);
+    scheduleSettingsSave();
+  });
+
+  copyGeneratedBtn.addEventListener('click', async () => {
+    if (!generatedResult.value) {
+      showToast('Generate a password first.', 'warning');
+      return;
+    }
+    const ok = await copyToClipboard(generatedResult.value);
+    showToast(ok ? 'Generated password copied.' : 'Clipboard unavailable.', ok ? 'success' : 'warning');
+  });
+
+  useForTestBtn.addEventListener('click', () => {
+    if (!generatedResult.value) {
+      showToast('Generate a password first.', 'warning');
+      return;
+    }
+    passwordInput.value = generatedResult.value;
+    updateStrength(generatedResult.value);
+    setView('tester');
+  });
+
+  saveGeneratedBtn.addEventListener('click', saveGeneratedToVault);
 
-loadInitialSettings().then(() => {
-  refreshVaultList();
+  createMasterForm.addEventListener('submit', handleCreateMaster);
+  unlockForm.addEventListener('submit', handleUnlock);
+  entryForm.addEventListener('submit', handleEntrySubmit);
+  masterForm.addEventListener('submit', changeMasterPassword);
+
+  modalBackdrop.addEventListener('click', () => {
+    closeModal('entryModal');
+    closeModal('masterModal');
+  });
+
+  document.querySelectorAll('[data-close]')?.forEach(button => {
+    button.addEventListener('click', event => {
+      const target = event.currentTarget.getAttribute('data-close');
+      closeModal(target);
+    });
+  });
+
+  addEntryBtn.addEventListener('click', () => openEntryModal());
+  changeMasterBtn.addEventListener('click', () => openMasterModal());
+  lockVaultBtn.addEventListener('click', () => lockVault(true));
+
+  vaultSearch.addEventListener('input', event => {
+    state.filter = event.target.value;
+    renderVaultEntries();
+    resetInactivityTimer();
+  });
+
+  viewTabs.forEach(tab => {
+    tab.addEventListener('click', () => {
+      setView(tab.dataset.view);
+    });
+  });
+
+  themeToggle.addEventListener('click', async () => {
+    if (!state.settings) return;
+    const currentIndex = THEMES.indexOf(state.settings.theme || 'system');
+    const nextTheme = THEMES[(currentIndex + 1) % THEMES.length];
+    state.settings.theme = nextTheme;
+    applyTheme(nextTheme);
+    await saveSettings(state.settings);
+  });
+}
+
+async function initialise() {
+  state.settings = await loadSettings();
+  if (!state.settings.theme) {
+    state.settings.theme = 'system';
+  }
+  applyTheme(state.settings.theme);
+  if (state.settings.theme === 'system' && window.matchMedia) {
+    window
+      .matchMedia('(prefers-color-scheme: dark)')
+      .addEventListener('change', () => applyTheme(state.settings.theme));
+  }
+  syncGeneratorControls();
   updateStrength('');
-});
+  attachEventListeners();
+  await loadVaultStatus();
+  setView('tester');
+}
+
+initialise();
diff --git a/extension/src/cryptoVault.js b/extension/src/cryptoVault.js
index ad45ad548fa415361be4d37f0d73e28f4cbbb530..d32fc7eae7a8bc3b97478e6e3de73e16d7eb3da6 100644
--- a/extension/src/cryptoVault.js
+++ b/extension/src/cryptoVault.js
@@ -1,33 +1,39 @@
 import { getStorage, setStorage } from './storage.js';
 import { loadSettings } from './settings.js';
 
 const VAULT_KEY = 'securepassVault';
 const ITERATIONS = 100000;
 const ENCODER = new TextEncoder();
 const DECODER = new TextDecoder();
-let cache = { data: null, timeout: null };
+const STORAGE_PREFERENCE = ['sync', 'local'];
+
+let cache = {
+  data: null,
+  timeout: null,
+  timeoutMinutes: 15
+};
 
 function bufferToBase64(buffer) {
   return btoa(String.fromCharCode(...new Uint8Array(buffer)));
 }
 
 function base64ToBuffer(base64) {
   const binary = atob(base64);
   const bytes = new Uint8Array(binary.length);
   for (let i = 0; i < binary.length; i += 1) {
     bytes[i] = binary.charCodeAt(i);
   }
   return bytes.buffer;
 }
 
 async function deriveKey(passphrase, salt, iterations = ITERATIONS) {
   const keyMaterial = await crypto.subtle.importKey(
     'raw',
     ENCODER.encode(passphrase),
     { name: 'PBKDF2' },
     false,
     ['deriveKey']
   );
   return crypto.subtle.deriveKey(
     {
       name: 'PBKDF2',
@@ -37,91 +43,226 @@ async function deriveKey(passphrase, salt, iterations = ITERATIONS) {
     },
     keyMaterial,
     { name: 'AES-GCM', length: 256 },
     false,
     ['encrypt', 'decrypt']
   );
 }
 
 async function encryptData(data, passphrase) {
   const salt = crypto.getRandomValues(new Uint8Array(16));
   const iv = crypto.getRandomValues(new Uint8Array(12));
   const key = await deriveKey(passphrase, salt.buffer);
   const encoded = ENCODER.encode(JSON.stringify(data));
   const ciphertext = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, encoded);
   return {
     salt: bufferToBase64(salt.buffer),
     iv: bufferToBase64(iv.buffer),
     ciphertext: bufferToBase64(ciphertext),
     iterations: ITERATIONS
   };
 }
 
 async function decryptData(record, passphrase) {
   const { salt, iv, ciphertext, iterations } = record;
   const key = await deriveKey(passphrase, base64ToBuffer(salt), iterations);
-  const decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv: new Uint8Array(base64ToBuffer(iv)) }, key, base64ToBuffer(ciphertext));
+  const decrypted = await crypto.subtle.decrypt(
+    { name: 'AES-GCM', iv: new Uint8Array(base64ToBuffer(iv)) },
+    key,
+    base64ToBuffer(ciphertext)
+  );
   return JSON.parse(DECODER.decode(decrypted));
 }
 
 async function loadVaultRecord() {
-  const stored = await getStorage('local', [VAULT_KEY]);
-  return stored[VAULT_KEY] || null;
+  for (const area of STORAGE_PREFERENCE) {
+    try {
+      const stored = await getStorage(area, [VAULT_KEY]);
+      if (stored && stored[VAULT_KEY]) {
+        if (area === 'local') {
+          try {
+            await setStorage('sync', { [VAULT_KEY]: stored[VAULT_KEY] });
+          } catch (error) {
+            // ignore sync errors, keep local copy as fallback
+          }
+        }
+        return stored[VAULT_KEY];
+      }
+    } catch (error) {
+      if (area === 'local') {
+        throw error;
+      }
+    }
+  }
+  return null;
 }
 
 async function saveVaultRecord(record) {
-  await setStorage('local', { [VAULT_KEY]: record });
+  let savedToSync = false;
+  try {
+    await setStorage('sync', { [VAULT_KEY]: record });
+    savedToSync = true;
+  } catch (error) {
+    // continue with local fallback
+  }
+
+  try {
+    await setStorage('local', { [VAULT_KEY]: record });
+  } catch (error) {
+    if (!savedToSync) {
+      throw error;
+    }
+  }
+}
+
+function resetTimeout(timeoutMinutes) {
+  if (cache.timeout) clearTimeout(cache.timeout);
+  cache.timeoutMinutes = timeoutMinutes;
+  cache.timeout = setTimeout(() => {
+    cache.data = null;
+    cache.timeout = null;
+  }, timeoutMinutes * 60 * 1000);
+}
+
+async function ensureUnlocked(passphrase, timeoutMinutes) {
+  if (!cache.data) {
+    await unlockVault(passphrase, timeoutMinutes || cache.timeoutMinutes || 15);
+  } else if (timeoutMinutes) {
+    resetTimeout(timeoutMinutes);
+  }
+  return cache.data;
+}
+
+function normalizeEntry(partial, existing) {
+  const now = new Date().toISOString();
+  const password = partial.password || existing?.password;
+  if (!password) {
+    throw new Error('Password is required');
+  }
+
+  return {
+    id: partial.id || existing?.id || crypto.randomUUID(),
+    site: (partial.site ?? existing?.site ?? '').trim(),
+    username: (partial.username ?? existing?.username ?? '').trim(),
+    notes: (partial.notes ?? existing?.notes ?? '').trim(),
+    password,
+    createdAt: existing?.createdAt || partial.createdAt || now,
+    updatedAt: now
+  };
+}
+
+async function writeVault(data, passphrase) {
+  const record = await encryptData(data, passphrase);
+  await saveVaultRecord(record);
+  cache.data = data;
 }
 
 export async function vaultStatus() {
   const record = await loadVaultRecord();
   return {
     initialized: Boolean(record),
     unlocked: Boolean(cache.data)
   };
 }
 
 export async function initializeVault(passphrase) {
   const record = await loadVaultRecord();
   if (record) return false;
   const payload = await encryptData({ entries: [] }, passphrase);
   await saveVaultRecord(payload);
   cache.data = { entries: [] };
+  const settings = await loadSettings();
+  resetTimeout(settings.vaultTimeout || 15);
   return true;
 }
 
 export async function unlockVault(passphrase, timeoutMinutes = 15) {
   const record = await loadVaultRecord();
   if (!record) {
     await initializeVault(passphrase);
     return cache.data;
   }
-  const data = await decryptData(record, passphrase);
+  let data;
+  try {
+    data = await decryptData(record, passphrase);
+  } catch (error) {
+    throw new Error('Invalid master password');
+  }
   cache.data = data;
-  if (cache.timeout) clearTimeout(cache.timeout);
-  cache.timeout = setTimeout(() => {
-    cache.data = null;
-  }, timeoutMinutes * 60 * 1000);
+  resetTimeout(timeoutMinutes);
   return data;
 }
 
 export function lockVault() {
   if (cache.timeout) clearTimeout(cache.timeout);
+  cache.timeout = null;
   cache.data = null;
 }
 
 export async function storeCredential(entry, passphrase) {
   const settings = await loadSettings();
-  const timeout = settings.vaultTimeout || 15;
-  if (!cache.data) {
-    await unlockVault(passphrase, timeout);
+  const timeout = settings.vaultTimeout || cache.timeoutMinutes || 15;
+  const data = await ensureUnlocked(passphrase, timeout);
+  const normalized = normalizeEntry(entry);
+  data.entries = data.entries || [];
+  data.entries.push(normalized);
+  await writeVault(data, passphrase);
+  resetTimeout(timeout);
+  return normalized;
+}
+
+export async function updateCredential(id, updates, passphrase) {
+  if (!id) throw new Error('Missing credential id');
+  const settings = await loadSettings();
+  const timeout = settings.vaultTimeout || cache.timeoutMinutes || 15;
+  const data = await ensureUnlocked(passphrase, timeout);
+  data.entries = data.entries || [];
+  const index = data.entries.findIndex(item => item.id === id);
+  if (index === -1) {
+    throw new Error('Credential not found');
   }
-  const data = cache.data || { entries: [] };
-  data.entries.push({ ...entry, createdAt: new Date().toISOString() });
-  const record = await encryptData(data, passphrase);
-  await saveVaultRecord(record);
+  const updated = normalizeEntry({ ...updates, id }, data.entries[index]);
+  data.entries[index] = updated;
+  await writeVault(data, passphrase);
+  resetTimeout(timeout);
+  return updated;
+}
+
+export async function deleteCredential(id, passphrase) {
+  if (!id) throw new Error('Missing credential id');
+  const settings = await loadSettings();
+  const timeout = settings.vaultTimeout || cache.timeoutMinutes || 15;
+  const data = await ensureUnlocked(passphrase, timeout);
+  data.entries = data.entries || [];
+  const index = data.entries.findIndex(item => item.id === id);
+  if (index === -1) {
+    throw new Error('Credential not found');
+  }
+  data.entries.splice(index, 1);
+  await writeVault(data, passphrase);
+  resetTimeout(timeout);
+}
+
+export async function changeMasterPassword(oldPassphrase, newPassphrase) {
+  if (!newPassphrase) {
+    throw new Error('New master password required');
+  }
+  const record = await loadVaultRecord();
+  if (!record) {
+    throw new Error('Vault not initialized');
+  }
+  let data;
+  try {
+    data = await decryptData(record, oldPassphrase);
+  } catch (error) {
+    throw new Error('Invalid current master password');
+  }
+  const newRecord = await encryptData(data, newPassphrase);
+  await saveVaultRecord(newRecord);
   cache.data = data;
+  const settings = await loadSettings();
+  resetTimeout(settings.vaultTimeout || cache.timeoutMinutes || 15);
 }
 
 export async function listCredentials() {
-  return cache.data ? cache.data.entries : [];
+  return cache.data ? [...(cache.data.entries || [])] : [];
 }
diff --git a/extension/src/passwordGenerator.js b/extension/src/passwordGenerator.js
index 6d0ef3ff2e9c073b0c3f4b788a1c7a40a1daae48..963c0a690768f4bf86dc3bf6ff45d7b4f7063839 100644
--- a/extension/src/passwordGenerator.js
+++ b/extension/src/passwordGenerator.js
@@ -1,109 +1,118 @@
 import { loadSettings } from './settings.js';
 
 const SIMILAR_CHARS = /[Il1O0]/g;
 
-function buildCharset(settings, constraints) {
+function buildCharset(options, constraints) {
   const requirements = {
     requiresUppercase: false,
     requiresLowercase: false,
     requiresNumber: false,
     requiresSymbol: false,
     ...(constraints.customRequirements || {})
   };
+
   let charset = '';
-  if (settings.includeLowercase) charset += 'abcdefghijklmnopqrstuvwxyz';
-  if (settings.includeUppercase) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
-  if (settings.includeNumbers) charset += '0123456789';
-  if (settings.includeSymbols) charset += '!@#$%^&*()-_=+[]{}|;:,.<>?';
-  if (!charset) charset = 'abcdefghijklmnopqrstuvwxyz0123456789';
+  if (options.includeLowercase) charset += 'abcdefghijklmnopqrstuvwxyz';
+  if (options.includeUppercase) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
+  if (options.includeNumbers) charset += '0123456789';
+  if (options.includeSymbols) charset += '!@#$%^&*()-_=+[]{}|;:,.<>?';
 
   if (constraints.pattern) {
-    // Try to infer from regex character classes
-    if (/\\d/.test(constraints.pattern) && !settings.includeNumbers) {
+    if (/\\d/.test(constraints.pattern) && !options.includeNumbers) {
       charset += '0123456789';
     }
-    if (/\[A-Z\]/.test(constraints.pattern) && !settings.includeUppercase) {
+    if (/\[A-Z\]/.test(constraints.pattern) && !options.includeUppercase) {
       charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
     }
-    if (/\[a-z\]/.test(constraints.pattern) && !settings.includeLowercase) {
+    if (/\[a-z\]/.test(constraints.pattern) && !options.includeLowercase) {
       charset += 'abcdefghijklmnopqrstuvwxyz';
     }
   }
 
-  if (requirements.requiresSymbol) {
+  if (requirements.requiresSymbol && !options.includeSymbols) {
     charset += '!@#$%^&*()-_=+[]{}|;:,.<>?';
   }
 
-  if (settings.avoidSimilar) {
+  charset = Array.from(new Set(charset.split(''))).join('');
+
+  if (options.avoidSimilar) {
     charset = charset.replace(SIMILAR_CHARS, '');
   }
 
-  return Array.from(new Set(charset.split(''))).join('');
+  if (!charset) {
+    throw new Error('Select at least one character set for password generation.');
+  }
+
+  return charset;
 }
 
 function ensureRequirements(password, charset, constraints) {
   const requirements = {
     requiresUppercase: false,
     requiresLowercase: false,
     requiresNumber: false,
     requiresSymbol: false,
     ...(constraints.customRequirements || {})
   };
   const replacements = [];
   if (requirements.requiresUppercase && !/[A-Z]/.test(password)) {
     replacements.push('ABCDEFGHIJKLMNOPQRSTUVWXYZ');
   }
   if (requirements.requiresLowercase && !/[a-z]/.test(password)) {
     replacements.push('abcdefghijklmnopqrstuvwxyz');
   }
   if (requirements.requiresNumber && !/\d/.test(password)) {
     replacements.push('0123456789');
   }
   if (requirements.requiresSymbol && !/[^\w\s]/.test(password)) {
     replacements.push('!@#$%^&*()-_=+[]{}|;:,.<>?');
   }
 
   let result = password.split('');
   const random = crypto.getRandomValues(new Uint32Array(replacements.length));
 
   replacements.forEach((set, index) => {
     const pos = random[index] % result.length;
     const char = set[random[index] % set.length];
     result[pos] = char;
   });
 
   return result.join('');
 }
 
 export async function generatePassword(constraints = {}) {
   const settings = await loadSettings();
-  const length = Math.min(
-    Math.max(constraints.minLength || settings.minLength, settings.minLength),
-    constraints.maxLength || 64
-  );
-  const charset = buildCharset(settings, {
+  const overrides = constraints.overrides || {};
+  const options = {
+    ...settings,
+    ...overrides
+  };
+
+  const requestedLength = constraints.length || overrides.minLength || settings.minLength;
+  const length = Math.max(4, Math.min(requestedLength, constraints.maxLength || 64));
+  const charset = buildCharset(options, {
     customRequirements: constraints.customRequirements || {},
     pattern: constraints.pattern || null
   });
 
   const cryptoArray = new Uint32Array(length);
   let password = '';
 
   for (let attempt = 0; attempt < 50; attempt += 1) {
     crypto.getRandomValues(cryptoArray);
     password = Array.from(cryptoArray, value => charset[value % charset.length]).join('');
     password = ensureRequirements(password, charset, {
       customRequirements: constraints.customRequirements || {}
     });
 
     if (constraints.pattern) {
       const regex = new RegExp(constraints.pattern);
       if (!regex.test(password)) {
         continue;
       }
     }
 
     if (constraints.confirmField) {
       constraints.confirmField.value = password;
       constraints.confirmField.dispatchEvent(new Event('input', { bubbles: true }));
     }
diff --git a/extension/src/storage.js b/extension/src/storage.js
index 5f1f3784f887052ddac50009c72d01c04b990ae9..8a8951d69d89597211348c0e22c9169873d77385 100644
--- a/extension/src/storage.js
+++ b/extension/src/storage.js
@@ -1,17 +1,41 @@
+function handleRuntimeError(reject, fallback) {
+  const error = chrome.runtime.lastError;
+  if (error) {
+    reject(new Error(error.message));
+    return true;
+  }
+  if (typeof fallback === 'function') {
+    fallback();
+  }
+  return false;
+}
+
 export function getStorage(area = 'local', keys) {
-  return new Promise(resolve => {
-    chrome.storage[area].get(keys, resolve);
+  return new Promise((resolve, reject) => {
+    chrome.storage[area].get(keys, items => {
+      if (!handleRuntimeError(reject)) {
+        resolve(items);
+      }
+    });
   });
 }
 
 export function setStorage(area = 'local', items) {
-  return new Promise(resolve => {
-    chrome.storage[area].set(items, resolve);
+  return new Promise((resolve, reject) => {
+    chrome.storage[area].set(items, () => {
+      if (!handleRuntimeError(reject)) {
+        resolve();
+      }
+    });
   });
 }
 
 export function removeStorage(area = 'local', keys) {
-  return new Promise(resolve => {
-    chrome.storage[area].remove(keys, resolve);
+  return new Promise((resolve, reject) => {
+    chrome.storage[area].remove(keys, () => {
+      if (!handleRuntimeError(reject)) {
+        resolve();
+      }
+    });
   });
 }
 
EOF
)
